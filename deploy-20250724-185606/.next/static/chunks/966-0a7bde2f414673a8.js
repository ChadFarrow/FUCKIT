"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{4966:(e,t,l)=>{l.d(t,{K:()=>n});class n{static async withRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MAX_RETRIES,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=null;for(let r=0;r<=t;r++)try{return await e()}catch(e){if(n=e,e instanceof Error&&(e.message.includes("Invalid RSS feed")||e.message.includes("Empty response")||e.message.includes("not valid XML")))throw e;if(r<t){let e=this.RETRY_DELAY_BASE*Math.pow(2,r);console.log("\uD83D\uDD04 Retry ".concat(r+1,"/").concat(t," for ").concat(l," after ").concat(e,"ms")),await new Promise(t=>setTimeout(t,e))}}throw n||Error("Operation failed after retries")}static async parseAlbumFeed(e){try{var t,l,n,r,o,a,i,s,c,u,m,g,d,f,h,p,E,y,v,N,b,T,B,w,A,C,S,x,D,R,k,F;let I,M,L;{let t=e.startsWith("/api/fetch-rss")?e:"/api/fetch-rss?url=".concat(encodeURIComponent(e));I=await fetch(t)}if(!I.ok)throw console.error("❌ RSS feed fetch failed: ".concat(e," - Status: ").concat(I.status)),Error("Failed to fetch RSS feed: ".concat(I.status));let P=await I.text();if(!P||0===P.trim().length)throw console.error("❌ Empty response from RSS feed: ".concat(e)),Error("Empty response from RSS feed");if(!P.includes("<")||!P.includes(">"))throw console.error("❌ Response does not look like XML for ".concat(e,":"),P.substring(0,200)),Error("Response is not valid XML");if((M=new DOMParser().parseFromString(P,"text/xml")).getElementsByTagName("parsererror")[0])throw Error("Invalid XML format");let U=M.getElementsByTagName("channel");if(!U||0===U.length)throw Error("Invalid RSS feed: no channel found");let _=U[0],X=_.getElementsByTagName("title")[0],q=(null==X||null==(t=X.textContent)?void 0:t.trim())||"Unknown Album",O=_.getElementsByTagName("description")[0],W=(null==O||null==(l=O.textContent)?void 0:l.trim())||"",Y=_.getElementsByTagName("link")[0],G=(null==Y||null==(n=Y.textContent)?void 0:n.trim())||"",j=e=>{if(e)return e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim()},H="Unknown Artist",K=_.getElementsByTagName("itunes:author"),$=K.length>0?K[0]:_.getElementsByTagName("author")[0];if($)H=(null==(E=$.textContent)?void 0:E.trim())||H;else{let e=q.split(" - ");e.length>1&&(H=e[0].trim())}let z=M.getElementsByTagName("item"),J=null,Q=_.getElementsByTagName("itunes:image")[0]||null;if(Q||(Q=_.querySelector("itunes\\:image")),Q&&(J=Q.getAttribute("href")||null),!J){let e=_.querySelector("image url");e&&(J=(null==(y=e.textContent)?void 0:y.trim())||null)}if(!J){let e=_.querySelector("image");if(e){let t=e.getAttribute("url")||e.getAttribute("href");t&&(J=t)}}if(!J){let e=z[0];if(e){let t=e.getElementsByTagName("itunes:image")[0];if(t&&(J=t.getAttribute("href")||null),!J){let t=e.getElementsByTagName("media:content")[0];t&&(null==(v=t.getAttribute("type"))?void 0:v.startsWith("image/"))&&(J=t.getAttribute("url")||null)}if(!J){let t=e.getElementsByTagName("enclosure")[0];t&&(null==(N=t.getAttribute("type"))?void 0:N.startsWith("image/"))&&(J=t.getAttribute("url")||null)}}}if(!J){let e=((null==(b=_.getElementsByTagName("description")[0])?void 0:b.textContent)||"").match(/<img[^>]+src=["']([^"']+)["'][^>]*>/i);e&&(J=e[1])}if(J)try{let e=new URL(J);J="".concat(e.protocol,"//").concat(e.host).concat(e.pathname)}catch(e){console.warn("Invalid cover art URL:",J)}J?console.log('\uD83C\uDFA8 Found cover art for "'.concat(q,'": ').concat(J)):console.warn('⚠️ No cover art found for "'.concat(q,'"'));let V=null==(o=_.getElementsByTagName("itunes:subtitle")[0])||null==(r=o.textContent)?void 0:r.trim(),Z=null==(i=_.getElementsByTagName("itunes:summary")[0])||null==(a=i.textContent)?void 0:a.trim(),ee=_.getElementsByTagName("language")[0],et=null==ee||null==(s=ee.textContent)?void 0:s.trim(),el=_.getElementsByTagName("copyright")[0],en=null==el||null==(c=el.textContent)?void 0:c.trim(),er=_.getElementsByTagName("itunes:explicit")[0],eo=(null==er||null==(u=er.textContent)?void 0:u.trim().toLowerCase())==="true",ea=_.getElementsByTagName("itunes:keywords")[0],ei=(null==ea||null==(m=ea.textContent)?void 0:m.trim().split(",").map(e=>e.trim()).filter(e=>e))||[],es=_.getElementsByTagName("itunes:category"),ec=Array.from(es).map(e=>e.getAttribute("text")).filter(Boolean),eu=_.getElementsByTagName("itunes:owner")[0],em=eu?{name:null==(d=eu.getElementsByTagName("itunes:name")[0])||null==(g=d.textContent)?void 0:g.trim(),email:null==(h=eu.getElementsByTagName("itunes:email")[0])||null==(f=h.textContent)?void 0:f.trim()}:void 0,eg=[];console.log("\uD83C\uDFB5 Found ".concat(z.length," items in RSS feed"));for(let e=0;e<z.length;e++){let t,l=z[e],n=(null==(B=l.getElementsByTagName("title")[0])||null==(T=B.textContent)?void 0:T.trim())||"Track ".concat(e+1),r="0:00",o=l.getElementsByTagName("itunes:duration")[0],a=l.getElementsByTagName("duration")[0];if((null==o||null==(w=o.textContent)?void 0:w.trim())?r=o.textContent.trim():(null==a||null==(A=a.textContent)?void 0:A.trim())&&(r=a.textContent.trim()),r&&""!==r.trim()){let e=r.trim();if(/^\d+$/.test(e)){let t=parseInt(e);if(!isNaN(t)&&t>0){let e=Math.floor(t/60),l=t%60;r="".concat(e,":").concat(l.toString().padStart(2,"0"))}}else if(e.includes(":")){let t=e.split(":");if(2===t.length){let e=parseInt(t[0]),l=parseInt(t[1]);!isNaN(e)&&!isNaN(l)&&e>=0&&l>=0&&l<60&&(r="".concat(e,":").concat(l.toString().padStart(2,"0")))}else if(3===t.length){let e=parseInt(t[0]),l=parseInt(t[1]),o=parseInt(t[2]);if(!isNaN(e)&&!isNaN(l)&&!isNaN(o)&&e>=0&&l>=0&&l<60&&o>=0&&o<60){let t=60*e+l,a=r;r="".concat(t,":").concat(o.toString().padStart(2,"0")),e>0&&console.log('\uD83D\uDD04 Converted HH:MM:SS "'.concat(a,'" to MM:SS "').concat(r,'" for "').concat(n,'"'))}}}}else r="0:00",console.log('⚠️ No duration found for track "'.concat(n,'", using default'));let i=l.getElementsByTagName("enclosure")[0];if(i&&(t=i.getAttribute("url")||void 0),!t){let e=l.getElementsByTagName("link")[0];e&&(t=(null==(F=e.textContent)?void 0:F.trim())||void 0)}if(!t){let e=l.getElementsByTagName("media:content")[0];e&&(t=e.getAttribute("url")||void 0)}let s=null==(S=l.getElementsByTagName("itunes:subtitle")[0])||null==(C=S.textContent)?void 0:C.trim(),c=null==(D=l.getElementsByTagName("itunes:summary")[0])||null==(x=D.textContent)?void 0:x.trim(),u=e=>{if(e)return e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim()},m=l.getElementsByTagName("itunes:image")[0],g=(null==m?void 0:m.getAttribute("href"))||(null==m?void 0:m.getAttribute("url")),d=l.getElementsByTagName("itunes:explicit")[0],f=(null==d||null==(R=d.textContent)?void 0:R.trim().toLowerCase())==="true",h=l.getElementsByTagName("itunes:keywords")[0],p=(null==h||null==(k=h.textContent)?void 0:k.trim().split(",").map(e=>e.trim()).filter(e=>e))||[];eg.push({title:n,duration:r,url:t,trackNumber:e+1,subtitle:u(s),summary:u(c),image:g||void 0,explicit:f,keywords:p.length>0?p:void 0}),console.log('✅ Added track: "'.concat(n,'" (').concat(r,") - URL: ").concat(t?"Found":"Missing"))}let ed=_.getElementsByTagName("pubDate")[0]||_.getElementsByTagName("lastBuildDate")[0],ef=(null==ed||null==(p=ed.textContent)?void 0:p.trim())||new Date().toISOString(),eh=[],ep=Array.from(_.getElementsByTagName("podcast:funding")),eE=Array.from(_.getElementsByTagName("funding"));[...ep,...eE].forEach(e=>{var t,l;let n=e.getAttribute("url")||(null==(t=e.textContent)?void 0:t.trim()),r=(null==(l=e.textContent)?void 0:l.trim())||e.getAttribute("message");n&&eh.push({url:n,message:r||void 0})});let ey=[],ev=Array.from(_.getElementsByTagName("podcast:podroll")),eN=Array.from(_.getElementsByTagName("podroll"));[...ev,...eN].forEach(e=>{var t;let l=Array.from(e.getElementsByTagName("podcast:remoteItem")),n=Array.from(e.getElementsByTagName("remoteItem"));[...l,...n].forEach(e=>{var t;let l=e.getAttribute("feedUrl"),n=e.getAttribute("feedGuid"),r=e.getAttribute("title")||(null==(t=e.textContent)?void 0:t.trim()),o=e.getAttribute("description");l&&ey.push({url:l,title:r||"Feed ".concat(n?n.substring(0,8)+"...":"Unknown"),description:o||void 0})});let r=e.getAttribute("url"),o=e.getAttribute("title")||(null==(t=e.textContent)?void 0:t.trim()),a=e.getAttribute("description");r&&ey.push({url:r,title:o||void 0,description:a||void 0})});let eb=Array.from(_.getElementsByTagName("podcast:remoteItem")).find(e=>"publisher"===e.getAttribute("medium"));if(eb){let e=eb.getAttribute("feedGuid"),t=eb.getAttribute("feedUrl"),l=eb.getAttribute("medium");e&&t&&l&&(L={feedGuid:e,feedUrl:t,medium:l})}return{title:q,artist:H,description:j(W)||"",coverArt:J,tracks:eg,releaseDate:ef,link:G,funding:eh.length>0?eh:void 0,subtitle:j(V),summary:j(Z),keywords:ei.length>0?ei:void 0,categories:ec.length>0?ec:void 0,explicit:eo,language:et,copyright:en,owner:em&&(em.name||em.email)?em:void 0,podroll:ey.length>0?ey:void 0,publisher:L}}catch(t){return console.error("❌ Error parsing RSS feed:",t),console.error("\uD83D\uDD0D Error details:",{message:t instanceof Error?t.message:"Unknown error",stack:t instanceof Error?t.stack:void 0,feedUrl:e}),null}}static async parseMultipleFeeds(e){console.log("\uD83D\uDD04 Parsing ".concat(e.length," RSS feeds..."));let t=[];for(let l=0;l<e.length;l+=20){let n=e.slice(l,l+20);console.log("\uD83D\uDCE6 Processing batch ".concat(Math.floor(l/20)+1,"/").concat(Math.ceil(e.length/20)," (").concat(n.length," feeds)"));let r=n.map(async e=>{try{return await this.withRetry(()=>this.parseAlbumFeed(e),2,"feed ".concat(e))}catch(t){if(t instanceof TypeError&&t.message.includes("NetworkError"))return console.error("❌ NetworkError when attempting to fetch resource."),console.log("\uD83D\uDD0D Error details:",{message:t.message,stack:t.stack,feedUrl:e}),null;return console.error("❌ Failed to parse feed ".concat(e," after retries:"),t),null}}),o=await Promise.allSettled(r),a=o.filter(e=>"fulfilled"===e.status&&null!==e.value),i=o.filter(e=>"rejected"===e.status||null===e.value);i.length>0&&(console.warn("⚠️ Failed to parse ".concat(i.length," feeds in batch ").concat(Math.floor(l/20)+1)),i.slice(0,3).forEach((e,t)=>{"rejected"===e.status?console.error("❌ Failed to parse feed ".concat(n[t],": ").concat(e.reason)):"fulfilled"===e.status&&null===e.value&&console.error("❌ Feed ".concat(n[t]," returned null"))}),i.length>3&&console.warn("... and ".concat(i.length-3," more failures"))),t.push(...a.map(e=>e.value)),l+20<e.length&&await new Promise(e=>setTimeout(e,50))}return console.log("✅ Successfully parsed ".concat(t.length," albums from ").concat(e.length," feeds")),t}static async parsePublisherFeedInfo(e){try{var t,l,n,r;let o,a;{let t=e.startsWith("/api/fetch-rss")?e:"/api/fetch-rss?url=".concat(encodeURIComponent(e));o=await fetch(t)}if(!o.ok)throw Error("Failed to fetch publisher feed: ".concat(o.status));let i=await o.text();if((a=new DOMParser().parseFromString(i,"text/xml")).getElementsByTagName("parsererror")[0])throw Error("Invalid XML format");let s=a.getElementsByTagName("channel");if(!s||0===s.length)throw Error("Invalid RSS feed: no channel found");let c=s[0],u=c.getElementsByTagName("title")[0],m=(null==u||null==(t=u.textContent)?void 0:t.trim())||"",g=c.getElementsByTagName("description")[0],d=(null==g||null==(l=g.textContent)?void 0:l.trim())||"",f=m,h=c.getElementsByTagName("itunes:author"),p=h.length>0?h[0]:c.getElementsByTagName("author")[0];p&&(f=(null==(n=p.textContent)?void 0:n.trim())||f);let E=null,y=c.getElementsByTagName("itunes:image")[0]||null;if(y||(y=c.querySelector("itunes\\:image")),y&&(E=y.getAttribute("href")||null),!E){let e=c.querySelector("image url");e&&(E=(null==(r=e.textContent)?void 0:r.trim())||null)}return{title:m,description:d,artist:f,coverArt:E||void 0}}catch(e){return console.error("❌ Error parsing publisher feed info:",e),null}}static async parsePublisherFeed(e){try{let t,l;{let l=e.startsWith("/api/fetch-rss")?e:"/api/fetch-rss?url=".concat(encodeURIComponent(e));t=await fetch(l)}if(!t.ok)throw Error("Failed to fetch publisher feed: ".concat(t.status));let n=await t.text();if((l=new DOMParser().parseFromString(n,"text/xml")).getElementsByTagName("parsererror")[0])throw Error("Invalid XML format");let r=l.getElementsByTagName("channel");if(!r||0===r.length)throw Error("Invalid RSS feed: no channel found");let o=r[0],a=[];return Array.from(o.getElementsByTagName("podcast:remoteItem")).forEach(e=>{var t;let l=e.getAttribute("medium"),n=e.getAttribute("feedGuid"),r=e.getAttribute("feedUrl"),o=e.getAttribute("title")||(null==(t=e.textContent)?void 0:t.trim());"music"===l&&n&&r&&a.push({feedGuid:n,feedUrl:r,medium:l,title:o})}),console.log("\uD83C\uDFE2 Found ".concat(a.length," music items in publisher feed: ").concat(e)),a}catch(e){return console.error("❌ Error parsing publisher feed:",e),[]}}static async parsePublisherFeedAlbums(e){console.log("\uD83C\uDFE2 Parsing publisher feed for albums: ".concat(e));let t=await this.parsePublisherFeed(e);if(0===t.length)return console.log("\uD83D\uDCED No music items found in publisher feed: ".concat(e)),[];let l=t.map(e=>e.feedUrl);console.log("\uD83C\uDFB5 Loading ".concat(l.length," music feeds from publisher..."));let n=5,r=500;l.length>20&&(n=8,r=300);let o=[];for(let e=0;e<l.length;e+=n){let t=l.slice(e,e+n),a=Math.floor(e/n)+1,i=Math.ceil(l.length/n);console.log("\uD83D\uDCE6 Processing publisher batch ".concat(a,"/").concat(i," (").concat(t.length," feeds)"));try{let e=await this.parseMultipleFeeds(t);o.push(...e),console.log("✅ Batch ".concat(a,"/").concat(i," completed: ").concat(e.length," albums (").concat(o.length,"/").concat(l.length," total)"))}catch(e){console.error("❌ Error in publisher batch ".concat(a,"/").concat(i,":"),e)}e+n<l.length&&await new Promise(e=>setTimeout(e,r))}return console.log("\uD83C\uDFB6 Loaded ".concat(o.length," albums from publisher feed")),o}}n.MAX_RETRIES=3,n.RETRY_DELAY_BASE=1e3}}]);