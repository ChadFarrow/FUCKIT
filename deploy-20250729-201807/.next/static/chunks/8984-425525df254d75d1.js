"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8984],{2895:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(2115),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(e,t)=>{let r=(0,o.forwardRef)((r,a)=>{let{color:l="currentColor",size:i=24,strokeWidth:c=2,absoluteStrokeWidth:s,className:u="",children:d,...p}=r;return(0,o.createElement)("svg",{ref:a,...n,width:i,height:i,stroke:l,strokeWidth:s?24*Number(c)/Number(i):c,className:["lucide","lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()),u].join(" "),...p},[...t.map(e=>{let[t,r]=e;return(0,o.createElement)(t,r)}),...Array.isArray(d)?d:[d]])});return r.displayName="".concat(e),r}},4304:(e,t,r)=>{r.d(t,{ToastContainer:()=>h,o:()=>m});var o=r(5155),n=r(2115),a=r(2895);let l=(0,a.A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var i=r(8533);let c=(0,a.A)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),s=(0,a.A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),u=(0,a.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),d={success:l,error:i.A,warning:c,info:s},p={success:"bg-green-500",error:"bg-red-500",warning:"bg-yellow-500",info:"bg-blue-500"};function f(e){let{toast:t,onDismiss:r}=e,a=d[t.type];return(0,n.useEffect)(()=>{if(t.duration&&t.duration>0){let e=setTimeout(()=>{r(t.id)},t.duration);return()=>clearTimeout(e)}},[t.id,t.duration,r]),(0,o.jsxs)("div",{className:"flex items-center gap-3 bg-gray-900 text-white p-4 rounded-lg shadow-lg min-w-[300px] max-w-md",children:[(0,o.jsx)("div",{className:"p-1 rounded ".concat(p[t.type]),children:(0,o.jsx)(a,{className:"h-5 w-5"})}),(0,o.jsx)("p",{className:"flex-1 text-sm",children:t.message}),(0,o.jsx)("button",{onClick:()=>r(t.id),className:"text-gray-400 hover:text-white transition-colors",children:(0,o.jsx)(u,{className:"h-4 w-4"})})]})}function h(){let[e,t]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=e=>{t(t=>[...t,e.detail])};return window.addEventListener("toast",e),()=>window.removeEventListener("toast",e)},[]);let r=e=>{t(t=>t.filter(t=>t.id!==e))};return 0===e.length?null:(0,o.jsx)("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:e.map(e=>(0,o.jsx)(f,{toast:e,onDismiss:r},e.id))})}let m={show:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,o=new CustomEvent("toast",{detail:{id:Math.random().toString(36).substr(2,9),type:e,message:t,duration:r}});window.dispatchEvent(o)},success:(e,t)=>{m.show("success",e,t)},error:(e,t)=>{m.show("error",e,t)},warning:(e,t)=>{m.show("warning",e,t)},info:(e,t)=>{m.show("info",e,t)}}},8533:(e,t,r)=>{r.d(t,{A:()=>o});let o=(0,r(2895).A)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8984:(e,t,r)=>{r.d(t,{AudioProvider:()=>s,G:()=>c});var o=r(5155),n=r(2115),a=r(4304),l=r(9588);let i=(0,n.createContext)(void 0),c=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useAudio must be used within an AudioProvider");return e},s=e=>{let{children:t}=e,[r,c]=(0,n.useState)(null),[s,u]=(0,n.useState)(!1),[d,p]=(0,n.useState)(0),[f,h]=(0,n.useState)(0),[m,y]=(0,n.useState)(0),[g,w]=(0,n.useState)([]),[k,v]=(0,n.useState)(!1),[b,x]=(0,n.useState)(!1),[L,E]=(0,n.useState)(!1),[S,A]=(0,n.useState)([]),[R,P]=(0,n.useState)(0),C=(0,n.useRef)(null),D=(0,n.useRef)(null),N=(0,n.useRef)(null);(0,n.useEffect)(()=>{{let e=localStorage.getItem("audioPlayerState");if(e)try{let t=JSON.parse(e);p(t.currentTrackIndex||0),h(t.currentTime||0),y(t.duration||0)}catch(e){console.warn("Failed to restore audio state:",e)}}},[]),(0,n.useEffect)(()=>{let e=()=>{C.current&&!k&&(v(!0),console.log("\uD83D\uDD13 Audio context unlocked via user interaction"))},t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),r=["click","touchstart","touchend","keydown"];return r.forEach(t=>{document.addEventListener(t,e,{once:!0})}),t&&console.log("\uD83D\uDCF1 Mobile device detected - audio will require explicit user interaction"),()=>{r.forEach(t=>{document.removeEventListener(t,e)})}},[]),(0,n.useEffect)(()=>{if(r){let e={currentPlayingAlbumTitle:r.title,currentTrackIndex:d,currentTime:f,duration:m,timestamp:Date.now()};localStorage.setItem("audioPlayerState",JSON.stringify(e))}},[r,d,f,m]),(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/albums");if(e.ok){let t=await e.json();w(t.albums||[])}}catch(e){console.warn("Failed to load albums for audio context:",e)}})()},[]);let U=e=>e.toLowerCase().includes(".m3u8"),M=e=>{let t=[];try{let r=new URL(e).hostname!==window.location.hostname;if(U(e))return t.push("/api/proxy-video?url=".concat(encodeURIComponent(e))),t.push("/api/proxy-audio?url=".concat(encodeURIComponent(e))),t.push(e),t;if(e.includes("op3.dev/e,")&&e.includes("/https://")){let r=e.split("/https://")[1];if(r){let o="https://".concat(r);console.log("\uD83D\uDD17 Extracted direct URL from op3.dev:",o),t.push(o),t.push("/api/proxy-audio?url=".concat(encodeURIComponent(o))),t.push("/api/proxy-audio?url=".concat(encodeURIComponent(e))),t.push(e)}else t.push("/api/proxy-audio?url=".concat(encodeURIComponent(e))),t.push(e)}else r&&t.push("/api/proxy-audio?url=".concat(encodeURIComponent(e))),t.push(e)}catch(r){console.warn("⚠️ Could not parse audio URL, using as-is:",e),t.push(e)}return t},I=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HLS playback",r=D.current;if(!r)return console.error("❌ Video element reference is null for HLS playback"),!1;let o=M(e);console.log("\uD83D\uDD04 ".concat(t,": Trying ").concat(o.length," HLS URLs"));for(let e=0;e<o.length;e++){let n=o[e];console.log("\uD83D\uDD04 ".concat(t," attempt ").concat(e+1,"/").concat(o.length,": ").concat(n.includes("proxy-audio")?"Proxied HLS URL":"Direct HLS URL"));try{if(N.current&&(N.current.destroy(),N.current=null),l.Ay.isSupported()){let o=new l.Ay({enableWorker:!0,lowLatencyMode:!1,xhrSetup:function(e,t){e.setRequestHeader("Access-Control-Allow-Origin","*")}});N.current=o,r.src="",r.load();let a=new Promise(n=>{let a=!1;o.on(l.Ay.Events.MANIFEST_PARSED,()=>{console.log("✅ HLS manifest parsed successfully")}),o.on(l.Ay.Events.LEVEL_LOADED,()=>{console.log("✅ HLS level loaded, attempting playback"),a||r.play().then(()=>{console.log("✅ ".concat(t," started successfully")),a=!0,n(!0)}).catch(e=>{console.error("❌ HLS playback failed:",e),a||(a=!0,n(!1))})}),o.on(l.Ay.Events.ERROR,(e,t)=>{console.error("❌ HLS error:",t),t.fatal&&(console.error("❌ Fatal HLS error, trying next URL"),o.destroy(),N.current=null,a||(a=!0,n(!1)))}),setTimeout(()=>{console.warn("⏰ ".concat(t," timed out for URL ").concat(e+1)),a||(a=!0,n(!1))},2e4)});if(o.loadSource(n),o.attachMedia(r),await a)return!0}else{if(!r.canPlayType("application/vnd.apple.mpegurl"))return console.error("❌ HLS not supported in this browser"),a.o.error("Video streaming not supported in this browser",5e3),!1;console.log("\uD83C\uDF4E Using Safari native HLS support"),r.src=n,r.load();let e=r.play();if(void 0!==e)return await e,console.log("✅ ".concat(t," started successfully with Safari native HLS")),!0}}catch(r){console.error("❌ ".concat(t," attempt ").concat(e+1," failed:"),r),N.current&&(N.current.destroy(),N.current=null),await new Promise(e=>setTimeout(e,1e3))}}return console.error("❌ All ".concat(o.length," HLS URLs failed for ").concat(t)),!1},T=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"playback",r=(e=>{let t=e.toLowerCase();return[".mp4",".webm",".ogg",".m3u8",".m4v",".mov",".avi",".mkv"].some(e=>t.includes(e))})(e),o=U(e);if(!(r?D.current:C.current))return console.error("❌ ".concat(r?"Video":"Audio"," element reference is null")),!1;if(x(r),r&&console.log("\uD83C\uDFAC Video URL detected, switching to video mode:",e),o)return console.log("\uD83D\uDCFA HLS stream detected, using hls.js:",e),I(e,t);let n=M(e);for(let e=0;e<n.length;e++){let o=n[e];console.log("\uD83D\uDD04 ".concat(t," attempt ").concat(e+1,"/").concat(n.length,": ").concat(o.includes("proxy-audio")?"Proxied URL":"Direct URL"));try{N.current&&(N.current.destroy(),N.current=null);let e=r?D.current:C.current;if(!e)return console.error("❌ ".concat(r?"Video":"Audio"," element became null during playback attempt")),!1;e.src=o,e.load(),r||(e.volume=.8),await new Promise(e=>setTimeout(e,100)),e.muted=!1,r||(e.volume=.8);let n=e.play();if(void 0!==n)return await n,console.log("✅ ".concat(t," started successfully with ").concat(o.includes("proxy-audio")?"proxied":"direct"," URL (").concat(r?"VIDEO":"AUDIO"," mode)")),!0}catch(r){if(console.warn("⚠️ ".concat(t," attempt ").concat(e+1," failed:"),r),r instanceof DOMException){if("NotAllowedError"===r.name){console.log("\uD83D\uDEAB Autoplay blocked - user interaction required. Please click or tap to enable audio."),a.o.info("Click anywhere on the page to enable audio playback",8e3);break}else if("NotSupportedError"===r.name){console.log("\uD83D\uDEAB Audio format not supported");continue}else if("AbortError"===r.name){console.log("\uD83D\uDEAB Audio request aborted - trying next URL");continue}else if(r.message.includes("CORS")||r.message.includes("cross-origin")){console.log("\uD83D\uDEAB CORS error - trying next URL");continue}}await new Promise(e=>setTimeout(e,500))}}return!1};(0,n.useEffect)(()=>{let e=C.current,t=D.current;if(!e||!t)return;let r=()=>{u(!0)},o=()=>{u(!1)},n=async()=>{try{await V()}catch(e){console.error("❌ Error in auto-play:",e)}},a=()=>{h((b?t:e).currentTime)},l=()=>{y((b?t:e).duration)},i=e=>{var t;let r=null==(t=e.target)?void 0:t.error;if(console.error("\uD83D\uDEAB ".concat(b?"Video":"Audio"," error:"),r),u(!1),N.current)console.log("\uD83D\uDD04 HLS error handled by hls.js, not clearing source");else{let e=b?D.current:C.current;e&&(e.src="",e.load())}},c=[e,t];return c.forEach(e=>{e.addEventListener("play",r),e.addEventListener("pause",o),e.addEventListener("ended",n),e.addEventListener("timeupdate",a),e.addEventListener("loadedmetadata",l),e.addEventListener("error",i)}),()=>{c.forEach(e=>{e.removeEventListener("play",r),e.removeEventListener("pause",o),e.removeEventListener("ended",n),e.removeEventListener("timeupdate",a),e.removeEventListener("loadedmetadata",l),e.removeEventListener("error",i)}),N.current&&(N.current.destroy(),N.current=null)}},[r,d,b]);let j=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.tracks||0===e.tracks.length)return console.error("❌ No tracks found in album"),!1;let r=e.tracks[t];if(!r||!r.url)return console.error("❌ No valid track found at index",t),!1;if(!k&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){console.log("\uD83D\uDCF1 Mobile device detected - enabling audio and attempting playback");try{if(v(!0),await T(r.url||"","Mobile album playback"))return c(e),p(t),console.log("✅ Mobile audio enabled and playback started"),!0;return a.o.info("Audio blocked by browser - please tap the play button again",3e3),!1}catch(e){return console.error("❌ Mobile audio enablement failed:",e),a.o.info("Please tap the play button again to enable audio",3e3),!1}}let o=await T(r.url,"Album playback");return o&&(c(e),p(t),v(!0),L||(E(!1),A([]),P(0))),o},H=async e=>{if(!S[e])return console.error("❌ Invalid shuffle track index:",e,"playlist length:",S.length),!1;let t=S[e],r=t.track,o=t.album;if(!r||!r.url)return console.error("❌ No valid track found in shuffled playlist"),!1;let n=await T(r.url,"Shuffled track playback");return n&&(c(o),p(t.trackIndex),P(e),v(!0)),n},O=async()=>{if(0===g.length)return console.warn("No albums available for shuffle"),!1;let e=[];if(g.forEach(t=>{t.tracks&&t.tracks.length>0&&t.tracks.forEach((r,o)=>{e.push({album:t,trackIndex:o,track:r})})}),0===e.length)return console.warn("No tracks available for shuffle"),!1;let t=[...e];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}A(t),P(0),E(!0);let r=t[0];console.log("\uD83C\uDFB2 Starting shuffle with:",r.track.title,"from",r.album.title);let o=r.track,n=r.album;if(!o||!o.url)return console.error("❌ No valid track found in shuffled playlist"),!1;let a=await T(o.url,"Shuffled track playback");return a&&(c(n),p(r.trackIndex),P(0),v(!0)),a},V=async()=>{if(L&&S.length>0){let e=R+1;if(e<S.length){let t=S[e];console.log("\uD83C\uDFB2 Playing next shuffled track:",t.track.title,"from",t.album.title),await H(e)}else console.log("\uD83D\uDD01 End of shuffled playlist reached, looping back to first track"),await H(0);return}if(!r||!r.tracks)return;let e=d+1;e<r.tracks.length?await j(r,e):await j(r,0)},q=async()=>{if(L&&S.length>0){let e=R-1;if(e>=0){let t=S[e];console.log("\uD83C\uDFB2 Playing previous shuffled track:",t.track.title,"from",t.album.title),await H(e)}else{let e=S.length-1,t=S[e];console.log("\uD83C\uDFB2 Playing last shuffled track:",t.track.title,"from",t.album.title),await H(e)}return}if(!r||!r.tracks)return;let e=d-1;e>=0&&(console.log("\uD83C\uDFB5 Playing previous track:",r.tracks[e].title),await j(r,e))};return(0,o.jsxs)(i.Provider,{value:{currentPlayingAlbum:r,isPlaying:s,currentTrackIndex:d,currentTime:f,duration:m,isVideoMode:b,isShuffleMode:L,playAlbum:j,playShuffledTrack:H,shuffleAllTracks:O,pause:()=>{let e=b?D.current:C.current;e&&e.pause()},resume:()=>{let e=b?D.current:C.current;e&&e.play()},seek:e=>{let t=b?D.current:C.current;t&&m&&(t.currentTime=Math.max(0,Math.min(e,m)),h(t.currentTime))},playNextTrack:V,playPreviousTrack:q,stop:()=>{C.current&&(C.current.pause(),C.current.currentTime=0),D.current&&(D.current.pause(),D.current.currentTime=0),N.current&&(N.current.destroy(),N.current=null),u(!1),c(null),p(0),h(0),y(0),x(!1),E(!1),A([]),P(0),localStorage.removeItem("audioPlayerState")},audioRef:C,videoRef:D},children:[t,(0,o.jsx)("audio",{ref:C,preload:"metadata",crossOrigin:"anonymous",playsInline:!0,"webkit-playsinline":"true",autoPlay:!1,controls:!1,muted:!1,style:{display:"none"}}),(0,o.jsx)("video",{ref:D,preload:"none",crossOrigin:"anonymous",playsInline:!0,"webkit-playsinline":"true",autoPlay:!1,controls:!1,muted:!1,style:{display:"none"}})]})}}}]);