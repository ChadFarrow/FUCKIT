exports.id=7292,exports.ids=[7292],exports.modules={16608:(a,b,c)=>{"use strict";c.d(b,{K:()=>l});class d{constructor(a=1){this.context={},this.level=a}setContext(a){this.context={...this.context,...a}}formatMessage(a,b,c){let d=new Date().toISOString(),e={...this.context,...c},f=Object.keys(e).length>0?` [${Object.entries(e).map(([a,b])=>`${a}=${b}`).join(", ")}]`:"";return`[${d}] [${a}]${f} ${b}`}debug(a,...b){this.level<=0&&console.log(this.formatMessage("DEBUG",a),...b)}info(a,...b){this.level<=1&&console.log(this.formatMessage("INFO",a),...b)}warn(a,...b){this.level<=2&&console.warn(this.formatMessage("WARN",a),...b)}error(a,b,c){if(this.level<=3){let d=b instanceof Error?{name:b.name,message:b.message,stack:b.stack}:b;console.error(this.formatMessage("ERROR",a,c),d)}}time(a){this.level<=0&&console.time(`[PERF] ${a}`)}timeEnd(a){this.level<=0&&console.timeEnd(`[PERF] ${a}`)}component(a){return{debug:(b,...c)=>this.debug(b,...c,{component:a}),info:(b,...c)=>this.info(b,...c,{component:a}),warn:(b,...c)=>this.warn(b,...c,{component:a}),error:(b,c)=>this.error(b,c,{component:a})}}function(a){return{debug:(b,...c)=>this.debug(b,...c,{function:a}),info:(b,...c)=>this.info(b,...c,{function:a}),warn:(b,...c)=>this.warn(b,...c,{function:a}),error:(b,c)=>this.error(b,c,{function:a})}}}let e=new d,f={NETWORK_ERROR:"NETWORK_ERROR",TIMEOUT_ERROR:"TIMEOUT_ERROR",RATE_LIMIT_ERROR:"RATE_LIMIT_ERROR",RSS_PARSE_ERROR:"RSS_PARSE_ERROR",RSS_FETCH_ERROR:"RSS_FETCH_ERROR",RSS_INVALID_FORMAT:"RSS_INVALID_FORMAT",AUDIO_LOAD_ERROR:"AUDIO_LOAD_ERROR",IMAGE_LOAD_ERROR:"IMAGE_LOAD_ERROR",IMAGE_TIMEOUT_ERROR:"IMAGE_TIMEOUT_ERROR"};class g extends Error{constructor(a,b="UNKNOWN_ERROR",c=500,d=!0,e,f){super(a),this.message=a,this.code=b,this.statusCode=c,this.isOperational=d,this.details=e,this.context=f,this.name="AppError",Error.captureStackTrace(this,this.constructor)}}async function h(a,b={}){let c,{maxRetries:d=3,delay:i=1e3,backoff:j=2,onRetry:k,context:l="withRetry"}=b;for(let b=1;b<=d;b++)try{return await a()}catch(h){if(c=h,b===d)throw e.error(`[${l}] Final retry attempt failed`,h,{context:l,attempt:b,maxRetries:d}),h;if(!function(a){return a instanceof g?[f.NETWORK_ERROR,f.TIMEOUT_ERROR,f.RATE_LIMIT_ERROR,f.RSS_FETCH_ERROR,f.AUDIO_LOAD_ERROR,f.IMAGE_LOAD_ERROR,f.IMAGE_TIMEOUT_ERROR].includes(a.code):a instanceof Error&&["network","timeout","fetch","429","rate limit","temporary","retry"].some(b=>a.message.toLowerCase().includes(b))}(h))throw e.warn(`[${l}] Non-retryable error, not retrying`,{context:l,attempt:b,error:h instanceof Error?h.message:h}),h;let a=i*Math.pow(j,b-1);e.warn(`[${l}] Attempt ${b} failed, retrying in ${a}ms`,{context:l,attempt:b,maxRetries:d,waitTime:a,error:h instanceof Error?h.message:h}),k&&k(b,h),await new Promise(b=>setTimeout(b,a))}throw c}let i="verbose"===process.env.NEXT_PUBLIC_LOG_LEVEL,j=(...a)=>{},k=(...a)=>{i&&console.log(...a)};class l{static{this.logger=function(a){return{error:(b,c,d)=>{new Date().toISOString(),c instanceof Error&&(c.name,c.message,c.stack),e.error(`[${a}] ${b}`,c,{context:a})},warn:(b,c)=>{let d=new Date().toISOString();e.warn(`[${a}] ${b}`,{timestamp:d,details:c})},info:(b,c)=>{let d=new Date().toISOString();e.info(`[${a}] ${b}`,{timestamp:d,details:c})}}}("RSSParser")}static async parseAlbumFeed(a){return h(async()=>{let b,d,e;k("[RSSParser] Parsing RSS feed",{feedUrl:a});try{b=await fetch(a)}catch(b){throw new g("Failed to fetch RSS feed",f.RSS_FETCH_ERROR,500,!0,{feedUrl:a,error:b})}if(!b.ok){if(429===b.status)throw new g("Rate limited while fetching RSS feed",f.RATE_LIMIT_ERROR,429,!0,{feedUrl:a,status:b.status});throw new g(`Failed to fetch RSS feed: ${b.status}`,f.RSS_FETCH_ERROR,b.status,b.status>=500,{feedUrl:a,status:b.status})}let h=await b.text();if(!h||0===h.trim().length)throw new g("Empty response from RSS feed",f.RSS_INVALID_FORMAT,400,!1,{feedUrl:a});if(!h.includes("<")||!h.includes(">"))throw this.logger.error("Invalid XML response",null,{feedUrl:a,responsePreview:h.substring(0,200)}),new g("Response is not valid XML",f.RSS_INVALID_FORMAT,400,!1,{feedUrl:a});try{{let{DOMParser:a}=await c.e(7219).then(c.t.bind(c,67219,19));d=new a().parseFromString(h,"text/xml")}let b=d.getElementsByTagName("parsererror")[0];if(b)throw new g("Invalid XML format in RSS feed",f.RSS_PARSE_ERROR,400,!1,{feedUrl:a,parserError:b.textContent})}catch(b){if(b instanceof g)throw b;throw new g("Failed to parse XML content",f.RSS_PARSE_ERROR,400,!1,{feedUrl:a,error:b})}let i=d.getElementsByTagName("channel");if(!i||0===i.length)throw new g("Invalid RSS feed: no channel found",f.RSS_INVALID_FORMAT,400,!1,{feedUrl:a});let l=i[0],m=l.getElementsByTagName("title")[0],n=m?.textContent?.trim()||"Unknown Album",o=l.getElementsByTagName("description")[0],p=o?.textContent?.trim()||"",q=l.getElementsByTagName("link")[0],r=q?.textContent?.trim()||"",s=a=>{if(a)return a.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim()},t="Unknown Artist",u=l.getElementsByTagName("itunes:author"),v=u.length>0?u[0]:l.getElementsByTagName("author")[0];if(v)t=v.textContent?.trim()||t;else{let a=n.split(" - ");a.length>1&&(t=a[0].trim())}let w=d.getElementsByTagName("item"),x=null,y=l.getElementsByTagName("itunes:image")[0]||null;if(y||(y=l.querySelector("itunes\\:image")),y&&(x=y.getAttribute("href")||null),!x){let a=l.querySelector("image url");a&&(x=a.textContent?.trim()||null)}if(!x&&w.length>0){let a=w[0].getElementsByTagName("itunes:image")[0];a&&(x=a.getAttribute("href")||null)}if(x)try{let a=new URL(x);(a.href.includes("javascript:")||a.href.includes("data:"))&&(console.warn("Potentially unsafe cover art URL detected:",x),x=null)}catch(a){x&&!x.startsWith("http")&&(k("Invalid cover art URL format:",x),x=null)}let z=l.getElementsByTagName("itunes:subtitle")[0]?.textContent?.trim(),A=l.getElementsByTagName("itunes:summary")[0]?.textContent?.trim(),B=l.getElementsByTagName("language")[0],C=B?.textContent?.trim(),D=l.getElementsByTagName("copyright")[0],E=D?.textContent?.trim(),F=l.getElementsByTagName("itunes:explicit")[0],G=F?.textContent?.trim().toLowerCase()==="true",H=l.getElementsByTagName("itunes:keywords")[0],I=H?.textContent?.trim().split(",").map(a=>a.trim()).filter(a=>a)||[],J=Array.from(l.getElementsByTagName("itunes:category")).map(a=>a.getAttribute("text")).filter(Boolean),K=l.getElementsByTagName("itunes:owner")[0],L=K?{name:K.getElementsByTagName("itunes:name")[0]?.textContent?.trim(),email:K.getElementsByTagName("itunes:email")[0]?.textContent?.trim()}:void 0,M=[];(w.length>10||0===w.length)&&j(`🎵 Found ${w.length} items in RSS feed`);for(let a=0;a<w.length;a++){let b,c=w[a],d=c.getElementsByTagName("title")[0]?.textContent?.trim()||`Track ${a+1}`,e="0:00",f=c.getElementsByTagName("itunes:duration")[0],g=c.getElementsByTagName("duration")[0];if(f?.textContent?.trim()?e=f.textContent.trim():g?.textContent?.trim()&&(e=g.textContent.trim()),e&&""!==e.trim()){let a=e.trim();if(/^\d+$/.test(a)){let b=parseInt(a);if(!isNaN(b)&&b>0){let a=Math.floor(b/60),c=b%60;e=`${a}:${c.toString().padStart(2,"0")}`}else e="0:00",k(`⚠️ Invalid duration seconds "${a}" for track "${d}", using default`)}else if(a.includes(":")){let b=a.split(":");if(2===b.length){let c=parseInt(b[0]),f=parseInt(b[1]);!isNaN(c)&&!isNaN(f)&&c>=0&&f>=0&&f<60?e=`${c}:${f.toString().padStart(2,"0")}`:(e="0:00",k(`⚠️ Invalid MM:SS duration "${a}" for track "${d}", using default`))}else if(3===b.length){let c=parseInt(b[0]),f=parseInt(b[1]),g=parseInt(b[2]);if(!isNaN(c)&&!isNaN(f)&&!isNaN(g)&&c>=0&&f>=0&&f<60&&g>=0&&g<60){let a=60*c+f,b=e;e=`${a}:${g.toString().padStart(2,"0")}`,c>0&&k(`🔄 Converted HH:MM:SS "${b}" to MM:SS "${e}" for "${d}"`)}else e="0:00",k(`⚠️ Invalid HH:MM:SS duration "${a}" for track "${d}", using default`)}else e="0:00",k(`⚠️ Unknown duration format "${a}" for track "${d}", using default`)}else e="0:00",k(`⚠️ Cannot parse duration "${a}" for track "${d}", using default`)}else e="0:00",k(`⚠️ No duration found for track "${d}", using default`);e.includes("NaN")&&(e="0:00",k(`⚠️ Duration contained NaN for track "${d}", using default`));let h=c.getElementsByTagName("enclosure")[0];if(h&&(b=h.getAttribute("url")||void 0),!b){let a=c.getElementsByTagName("link")[0];a&&(b=a.textContent?.trim()||void 0)}if(!b){let a=c.getElementsByTagName("media:content")[0];a&&(b=a.getAttribute("url")||void 0)}let i=c.getElementsByTagName("itunes:subtitle")[0]?.textContent?.trim(),j=c.getElementsByTagName("itunes:summary")[0]?.textContent?.trim(),l=a=>{if(a)return a.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim()},m=c.getElementsByTagName("itunes:image")[0],n=m?.getAttribute("href")||m?.getAttribute("url"),o=c.getElementsByTagName("itunes:explicit")[0],p=o?.textContent?.trim().toLowerCase()==="true",q=c.getElementsByTagName("itunes:keywords")[0],r=q?.textContent?.trim().split(",").map(a=>a.trim()).filter(a=>a)||[];M.push({title:d,duration:e,url:b,trackNumber:a+1,subtitle:l(i),summary:l(j),image:n||void 0,explicit:p,keywords:r.length>0?r:void 0}),b||k(`⚠️ Track missing URL: "${d}" (${e})`)}let N=l.getElementsByTagName("pubDate")[0]||l.getElementsByTagName("lastBuildDate")[0],O=N?.textContent?.trim()||new Date().toISOString(),P=[];[...Array.from(l.getElementsByTagName("podcast:funding")),...Array.from(l.getElementsByTagName("funding"))].forEach(a=>{let b=a.getAttribute("url")||a.textContent?.trim(),c=a.textContent?.trim()||a.getAttribute("message");b&&P.push({url:b,message:c||void 0})});let Q=[];[...Array.from(l.getElementsByTagName("podcast:podroll")),...Array.from(l.getElementsByTagName("podroll"))].forEach(a=>{[...Array.from(a.getElementsByTagName("podcast:remoteItem")),...Array.from(a.getElementsByTagName("remoteItem"))].forEach(a=>{let b=a.getAttribute("feedUrl"),c=a.getAttribute("feedGuid"),d=a.getAttribute("title")||a.textContent?.trim(),e=a.getAttribute("description");b&&Q.push({url:b,title:d||`Feed ${c?c.substring(0,8)+"...":"Unknown"}`,description:e||void 0})});let b=a.getAttribute("url"),c=a.getAttribute("title")||a.textContent?.trim(),d=a.getAttribute("description");b&&Q.push({url:b,title:c||void 0,description:d||void 0})});let R=Array.from(l.getElementsByTagName("podcast:remoteItem")).find(a=>"publisher"===a.getAttribute("medium"));if(R){let a=R.getAttribute("feedGuid"),b=R.getAttribute("feedUrl"),c=R.getAttribute("medium");a&&b&&c&&(e={feedGuid:a,feedUrl:b,medium:c})}let S={title:n,artist:t,description:s(p)||"",coverArt:x,tracks:M,releaseDate:O,link:r,funding:P.length>0?P:void 0,subtitle:s(z),summary:s(A),keywords:I.length>0?I:void 0,categories:J.length>0?J:void 0,explicit:G,language:C,copyright:E,owner:L&&(L.name||L.email)?L:void 0,podroll:Q.length>0?Q:void 0,publisher:e};return k("[RSSParser] Successfully parsed RSS feed",{feedUrl:a,trackCount:M.length}),S},{maxRetries:3,delay:1e3,onRetry:(b,c)=>{this.logger.warn(`Retrying RSS feed parse (attempt ${b})`,{feedUrl:a,error:c})}}).catch(b=>(this.logger.error("Failed to parse RSS feed after retries",b,{feedUrl:a}),null))}static async parseMultipleFeeds(a){a.length>5&&j(`🔄 Parsing ${a.length} RSS feeds...`);let b=[];for(let c=0;c<a.length;c+=20){let d=a.slice(c,c+20);a.length>10&&j(`📦 Processing batch ${Math.floor(c/20)+1}/${Math.ceil(a.length/20)} (${d.length} feeds)`);let e=d.map(async a=>{try{return await h(()=>this.parseAlbumFeed(a),{maxRetries:2,delay:1e3,onRetry:(b,c)=>{this.logger.warn(`Retrying feed parse (attempt ${b})`,{url:a,error:c})}})}catch(b){if(b instanceof TypeError&&b.message.includes("NetworkError"))return console.error(`❌ NetworkError when attempting to fetch resource.`),console.log("\uD83D\uDD0D Error details:",{message:b.message,stack:b.stack,feedUrl:a}),null;return console.error(`❌ Failed to parse feed ${a} after retries:`,b),null}}),f=await Promise.allSettled(e),g=f.filter(a=>"fulfilled"===a.status&&null!==a.value),i=f.filter(a=>"rejected"===a.status||null===a.value);i.length>0&&a.length>10&&(console.warn(`⚠️ Failed to parse ${i.length} feeds in batch ${Math.floor(c/20)+1}`),i.slice(0,2).forEach((a,b)=>{"rejected"===a.status?console.error(`❌ Failed to parse feed ${d[b]}: ${a.reason}`):"fulfilled"===a.status&&null===a.value&&console.error(`❌ Feed ${d[b]} returned null`)}),i.length>2&&console.warn(`... and ${i.length-2} more failures`)),b.push(...g.map(a=>a.value)),c+20<a.length&&await new Promise(a=>setTimeout(a,50))}return a.length>5&&j(`✅ Successfully parsed ${b.length} albums from ${a.length} feeds`),b}static async parsePublisherFeedInfo(a){try{let b,d;if(!(b=await fetch(a)).ok)throw Error(`Failed to fetch publisher feed: ${b.status}`);let e=await b.text();{let{DOMParser:a}=await c.e(7219).then(c.t.bind(c,67219,19));d=new a().parseFromString(e,"text/xml")}if(d.getElementsByTagName("parsererror")[0])throw Error("Invalid XML format");let f=d.getElementsByTagName("channel");if(!f||0===f.length)throw Error("Invalid RSS feed: no channel found");let g=f[0],h=g.getElementsByTagName("title")[0],i=h?.textContent?.trim()||"",j=g.getElementsByTagName("description")[0],k=j?.textContent?.trim()||"",l=i,m=g.getElementsByTagName("itunes:author"),n=m.length>0?m[0]:g.getElementsByTagName("author")[0];n&&(l=n.textContent?.trim()||l);let o=null,p=g.getElementsByTagName("itunes:image")[0]||null;if(p||(p=g.querySelector("itunes\\:image")),p&&(o=p.getAttribute("href")||null),!o){let a=g.querySelector("image url");a&&(o=a.textContent?.trim()||null)}return{title:i,description:k,artist:l,coverArt:o||void 0}}catch(a){return console.error("❌ Error parsing publisher feed info:",a),null}}static async parsePublisherFeed(a){try{let b,d;if("iroh-aggregated"===a){let a,b;console.log("\uD83C\uDFB5 Loading IROH aggregated feed from Wavlake...");if(!(a=await fetch("https://wavlake.com/feed/artist/8a9c2e54-785a-4128-9412-737610f5d00a")).ok)throw Error(`Failed to fetch IROH artist feed: ${a.status}`);let d=await a.text();{let{DOMParser:a}=await c.e(7219).then(c.t.bind(c,67219,19));b=new a().parseFromString(d,"text/xml")}if(b.getElementsByTagName("parsererror")[0])throw Error("Invalid XML format");let e=b.getElementsByTagName("channel");if(!e||0===e.length)throw Error("Invalid RSS feed: no channel found");let f=e[0],g=[];return Array.from(f.getElementsByTagName("podcast:remoteItem")).forEach(a=>{let b=a.getAttribute("medium"),c=a.getAttribute("feedGuid"),d=a.getAttribute("feedUrl"),e=a.getAttribute("title")||a.textContent?.trim();"music"===b&&c&&d&&g.push({feedGuid:c,feedUrl:d,medium:b,title:e})}),j(`🏢 Found ${g.length} music items in IROH aggregated feed`),g}if("string"!=typeof a)throw console.error("parsePublisherFeed: feedUrl is not a string:",a),TypeError("feedUrl must be a string (URL). Received: "+typeof a);if(!(b=await fetch(a)).ok)throw Error(`Failed to fetch publisher feed: ${b.status}`);let e=await b.text();{let{DOMParser:a}=await c.e(7219).then(c.t.bind(c,67219,19));d=new a().parseFromString(e,"text/xml")}if(d.getElementsByTagName("parsererror")[0])throw Error("Invalid XML format");let f=d.getElementsByTagName("channel");if(!f||0===f.length)throw Error("Invalid RSS feed: no channel found");let g=f[0],h=[];return Array.from(g.getElementsByTagName("podcast:remoteItem")).forEach(a=>{let b=a.getAttribute("medium"),c=a.getAttribute("feedGuid"),d=a.getAttribute("feedUrl"),e=a.getAttribute("title")||a.textContent?.trim();"music"===b&&c&&d&&h.push({feedGuid:c,feedUrl:d,medium:b,title:e})}),j(`🏢 Found ${h.length} music items in publisher feed: ${a}`),h}catch(a){return console.error("❌ Error parsing publisher feed:",a),[]}}static async parsePublisherFeedAlbums(a){j(`🏢 Parsing publisher feed for albums: ${a}`);let b=await this.parsePublisherFeed(a);if(0===b.length)return j(`📭 No music items found in publisher feed: ${a}`),[];let c=b.map(a=>a.feedUrl);j(`🎵 Loading ${c.length} music feeds from publisher...`);let d=5,e=500;c.length>20&&(d=8,e=300);let f=[];for(let a=0;a<c.length;a+=d){let b=c.slice(a,a+d),g=Math.floor(a/d)+1,h=Math.ceil(c.length/d);j(`📦 Processing publisher batch ${g}/${h} (${b.length} feeds)`);try{let a=await this.parseMultipleFeeds(b);f.push(...a),j(`✅ Batch ${g}/${h} completed: ${a.length} albums (${f.length}/${c.length} total)`)}catch(a){console.error(`❌ Error in publisher batch ${g}/${h}:`,a)}a+d<c.length&&await new Promise(a=>setTimeout(a,e))}return j(`🎶 Loaded ${f.length} albums from publisher feed`),f}}},78335:()=>{},96487:()=>{}};